/*! Chartinator jQuery plugin 2015-03-24 version: 0.2.0 */
!function(a,b){var c=function(c,d){var e=this,f=a(c),g=a(c);return e.getFontFamily=function(b,c){var d=a(b).css("font-family").replace(/["']{1}/gi,"")||c;return d},e.bodyFontSize=parseInt(a("body").css("fontSize"),10),e.h3FontSize=parseInt(a("h3").css("fontSize"),10),e.fontFamily=e.getFontFamily("body","Arial, Helvetica, sans-serif"),e.optionsInit={urlJSAPI:"https://www.google.com/jsapi",columns:!1,colIndexes:!1,rows:!1,tableSel:!1,ignoreCol:[],fontSize:e.bodyFontSize,tooltipConcat:!1,annotationConcat:!1,chartType:"BarChart",chartClass:"chtr-chart",barChart:{chartHeightRatio:.75,chartArea:{left:"20%",top:40,width:"75%",height:"85%"},fontSize:e.bodyFontSize,fontName:e.fontFamily,titleTextStyle:{fontSize:e.h3FontSize},legend:{position:"bottom"}},pieChart:{chartHeightRatio:.75,chartArea:{left:0,top:0,width:"100%",height:"100%"},fontSize:e.bodyFontSize,fontName:e.fontFamily,titleTextStyle:{fontSize:e.h3FontSize}},columnChart:{chartHeightRatio:.75,fontSize:e.bodyFontSize,fontName:e.fontFamily,legend:{position:"bottom"},titleTextStyle:{fontSize:e.h3FontSize}},geoChart:{chartHeightRatio:.75},calendarChart:{chartHeightRatio:.3,cellScaleFactor:.017,calendar:{monthLabel:{fontName:e.fontFamily,fontSize:e.bodyFontSize},dayOfWeekLabel:{fontName:e.fontFamily,fontSize:.8*e.bodyFontSize}}},tableChart:{formatter:{type:"none",column:1},allowHtml:!0,cssClassNames:{headerRow:"headerRow",tableRow:"tableRow",oddTableRow:"oddTableRow",selectedTableRow:"selectedTableRow",hoverTableRow:"hoverTableRow",headerCell:"headerCell",tableCell:"tableCell",rowNumberCell:"rowNumberCell"}},showTable:"hide",showTableCSS:{position:"static",top:0,width:""},hideTableCSS:{position:"absolute",top:"-9999px",width:f.width()},showChartCSS:{},hideChartCSS:{opacity:0}},e.cOptions={},e.timer=!1,e.tableClone=!1,e.chartPackage="corechart",e.init=function(c,d){var h=!1,i="";if(e.options=a.extend({},e.optionsInit,d),e.options.tableSel&&(f=a(e.options.tableSel+" td").length?a(e.options.tableSel):f),h=f.find("td").length,h&&(e.tableClone=f.clone(),i=e.tableClone.find("caption").text()),g[0]===f[0]&&(h?g=a('<div class="'+e.options.chartClass+'"></div>').insertAfter(f):f=!1),e.cOptions=a.extend(!0,{},e.options),"BarChart"===e.cOptions.chartType)e.cOptions=e.cOptions.barChart,e.cOptions.title=e.cOptions.title||i,e.cOptions.height=e.cOptions.height||g.width()*e.cOptions.chartHeightRatio;else if("ColumnChart"===e.cOptions.chartType)e.cOptions=e.cOptions.columnChart,e.cOptions.title=e.cOptions.title||i,e.cOptions.height=e.cOptions.height||g.width()*e.cOptions.chartHeightRatio;else if("PieChart"===e.cOptions.chartType)e.cOptions=e.cOptions.pieChart,e.cOptions.title=e.cOptions.title||i,e.cOptions.height=e.cOptions.height||g.width()*e.cOptions.chartHeightRatio;else if("GeoChart"===e.cOptions.chartType)e.cOptions=e.cOptions.geoChart,e.chartPackage="geochart",e.cOptions.height=e.cOptions.height||g.width()*e.cOptions.chartHeightRatio;else if("Calendar"===e.cOptions.chartType)e.cOptions=e.cOptions.calendarChart,e.chartPackage="calendar",e.cOptions.title=e.cOptions.title||i,e.cOptions.height=e.cOptions.height||g.width()*e.cOptions.chartHeightRatio,e.cOptions.calendar.cellSize=e.cOptions.calendar.cellSize||g.width()*e.cOptions.cellScaleFactor;else{if("Table"!==e.options.chartType)return e.showTableChart("show","remove"),void console.log("Unrecognized chart type");e.cOptions=e.cOptions.tableChart,e.chartPackage="table"}h||e.options.rows&&e.options.columns?(e.setupChart(),a(b).on({resize:function(){a(b).width()!==e.windowWidth&&(clearTimeout(e.timer),e.timer=setTimeout(function(){g.removeAttr("style"),f&&f.removeAttr("style"),e.cOptions.calendar&&!e.options.calendarChart.calendar.cellSize&&(e.cOptions.calendar.cellSize=.017*g.width()),e.cOptions.chartHeightRatio&&!(e.options.barChart.height||e.options.pieChart.height||e.options.columnChart.height||e.options.geoChart.height||e.options.calendarChart.height)&&(e.cOptions.height=g.width()*e.cOptions.chartHeightRatio),e.chart.draw(e.data,e.cOptions)},500))}})):e.showTableChart("show","remove")},e.setupChart=function(){e.showTableChart("hide","hide");try{a.ajax({url:e.options.urlJSAPI,dataType:"script",cache:!0}).done(function(){google.load("visualization","1",{packages:[e.chartPackage],callback:e.drawChart})}).fail(function(){e.showTableChart("show","remove")})}catch(b){e.showTableChart("show","remove"),console.log(b)}},e.drawChart=function(){var b=[];if(e.tableClone&&e.tableClone.find("td").length&&(b=e.getTableData()),e.options.columns)if(b[0]&&b[0][0].label)if(e.options.colIndexes)for(var c=0;c<e.options.colIndexes.length;c++)b[0].splice(e.options.colIndexes[c],0,e.options.columns[c]);else b[0]=e.options.columns;else b.unshift(e.options.columns);if(e.options.rows&&b.length)if(e.options.colIndexes)for(var c=0;c<e.options.rows.length;c++)for(var d=0;d<e.options.colIndexes.length;d++)b[c+1].splice(e.options.colIndexes[d],0,e.options.rows[c][d]);else a.merge(b,e.options.rows);if(!b.length)return e.showTableChart("show","remove"),void console.log("No data found in data array");if(e.data=new google.visualization.arrayToDataTable(b),!e.data||!e.data.getNumberOfRows())return e.showTableChart("show","remove"),void console.log("Google Charts data table failed");if("none"!==e.options.tableChart.formatter.type){var f=new google.visualization[e.options.tableChart.formatter.type](e.options.tableChart.formatter);f.format(e.data,e.options.tableChart.formatter.column)}"BarChart"===e.options.chartType&&(e.cOptions.height=e.cOptions.height||2*e.options.fontSize*e.data.getNumberOfRows()),e.chart=new google.visualization[e.options.chartType](g.get(0)),google.visualization.events.addListener(e.chart,"ready",function(){e.showTableChart(e.options.showTable,"show")}),google.visualization.events.addListener(e.chart,"error",function(){e.showTableChart("show","remove")}),e.chart.draw(e.data,e.cOptions)},e.getTableData=function(){var b=[];try{var c=e.tableClone.find("th"),d=e.tableClone.find("tr"),f=[],g=[],h=[];c.each(function(b){if(-1===e.options.ignoreCol.indexOf(b)){var c=a(this),d={};c.attr("data-type")&&(d.type=c.attr("data-type")),c.attr("data-role")&&(d.role=c.attr("data-role")),d.role&&["tooltip","annotation"].indexOf(d.role)>-1?"tooltip"===d.role&&-1===g.indexOf(b-1)?f.push(d):"annotation"===d.role&&-1===h.indexOf(b-1)&&f.push(d):d.type&&(d.label=c.text(),f.push(d),e.options.tooltipConcat&&b>0&&(f.push({type:"string",role:"tooltip"}),g.push(b)),e.options.annotationConcat&&b>0&&(f.push({type:"string",role:"annotation"}),h.push(b)))}}),f.length>0&&b.push(f),d.each(function(){var c=[],d=!1,f=0;a(this).find("td").each(function(i){if(-1===e.options.ignoreCol.indexOf(i)){var j=a(this),k=j.attr("data-type"),l=j.attr("data-role"),m="Axis "+i.toString();if(b[0]&&b[0][f]&&(k=b[0][f].type||k,l=b[0][f].role||l,m=b[0][f].label||m),("domain"===l||0===i)&&(d=j.text()),-1===["tooltip","annotation"].indexOf(l)?"date"===k?(c.push(new Date(j.text())),f++):"number"===k?(c.push(Number(j.text())),f++):(c.push(j.text()),f++):"tooltip"===l&&-1===g.indexOf(i-1)?(c.push(j.text()),f++):"annotation"===l&&-1===h.indexOf(i-1)&&(c.push(j.text()),f++),g.indexOf(i)>-1){var n=e.options.tooltipConcat.replace(new RegExp("domain","g"),d);n=n.replace(new RegExp("label","g"),m),n=n.replace(new RegExp("data","g"),j.text()),c.push(n),f++}if(h.indexOf(i)>-1){var o=e.options.annotationConcat.replace(new RegExp("domain","g"),d);o=o.replace(new RegExp("label","g"),m),o=o.replace(new RegExp("data","g"),j.text()),c.push(o),f++}}}),c.length>0&&b.push(c)})}catch(i){return console.log(i),[]}return b},e.showTableChart=function(a,b){var c=f?f.length:!1,d=g?g.length:!1;"show"===a&&c?(f.css("opacity",0),f.css(e.options.showTableCSS),f.fadeTo(400,1)):"hide"===a&&c?f.css(e.options.hideTableCSS):"remove"===a&&c&&f.css("display","none"),"show"===b&&d?(g.css("opacity",0),g.css(e.options.showChartCSS),g.fadeTo(400,1)):"hide"===b&&d?g.css(e.options.showChartCSS):"remove"===b&&d&&g.css("display","none")},e.init(c,d),this};a.fn.chartinator=function(b){return this.each(function(){var d=a(this);d.data("chartinator")||a(this).data("chartinator",new c(this,b))})}}(jQuery,window,document,Math);