/*! Chartinator jQuery plugin 2015-03-19 version: 0.1.1 */
!function(a,b){var c=function(c,d){console.log("start");var e=this,f=a(c),g=a(c);return e.getFontFamily=function(b,c){var d=a(b).css("font-family").replace(/["']{1}/gi,"")||c;return d},e.bodyFontSize=parseInt(a("body").css("fontSize"),10),e.h3FontSize=parseInt(a("h3").css("fontSize"),10),e.fontFamily=e.getFontFamily("body","Arial, Helvetica, sans-serif"),e.optionsInit={urlJSAPI:"https://www.google.com/jsapi",tableSel:!1,fontSize:e.bodyFontSize,tooltipConcat:[],chartType:"BarChart",chartClass:"chtr-chart",barChart:{chartArea:{left:"20%",top:40,width:"75%",height:"85%"},fontSize:e.bodyFontSize,fontName:e.fontFamily,titleTextStyle:{fontSize:e.h3FontSize},legend:{position:"bottom"}},pieChart:{chartArea:{left:0,top:0,width:"100%",height:"100%"},fontSize:e.bodyFontSize,fontName:e.fontFamily,titleTextStyle:{fontSize:e.h3FontSize}},columnChart:{fontSize:e.bodyFontSize,fontName:e.fontFamily,legend:{position:"bottom"},titleTextStyle:{fontSize:e.h3FontSize}},geoChart:{},calendarChart:{},tableChart:{formatter:{type:"none",column:1},allowHtml:!0,cssClassNames:{headerRow:"headerRow",tableRow:"tableRow",oddTableRow:"oddTableRow",selectedTableRow:"selectedTableRow",hoverTableRow:"hoverTableRow",headerCell:"headerCell",tableCell:"tableCell",rowNumberCell:"rowNumberCell"}},showTable:"hide",showTableCSS:{position:"static",top:0,width:""},hideTableCSS:{position:"absolute",top:"-9999px",width:f.width()},showChartCSS:{},hideChartCSS:{opacity:0}},e.cOptions={},e.timer=!1,e.tableClone=!1,console.log("vars-end"+f.attr("id")),e.init=function(c,d){console.log("init-start"+f.attr("id")),e.options=a.extend({},e.optionsInit,d),e.options.tableSel&&(f=a(e.options.tableSel).length?a(e.options.tableSel):f),g[0]===f[0]&&(g=a('<div class="'+e.options.chartClass+'"></div>').insertAfter(f)),f.length?(e.setupChart(),a(b).on({resize:function(){a(b).width()!==e.windowWidth&&(clearTimeout(e.timer),e.timer=setTimeout(function(){g.removeAttr("style"),f.removeAttr("style"),e.drawChart()},500))}})):(e.showTableChart("show","remove"),console.log("Chart and or HTML table not found"))},e.setupChart=function(){e.tableClone||(e.tableClone=f.clone()),e.showTableChart("hide","hide");var b="corechart";"Table"===e.options.chartType?b="table":"Calendar"===e.options.chartType?b="calendar":"GeoChart"===e.options.chartType&&(b="geochart");try{a.ajax({url:e.options.urlJSAPI,dataType:"script",cache:!0}).done(function(){google.load("visualization","1",{packages:[b],callback:e.drawChart}),console.log("Create and draw Chart")}).fail(function(){e.showTableChart("show","remove")})}catch(c){e.showTableChart("show","remove"),console.log(c+f.attr("id"))}},e.drawChart=function(){console.log("draw-start"+f.attr("id"));var b={},c=e.tableClone.find("caption").text(),d=e.tableClone.find("th"),h=e.tableClone.find("tr"),i=new google.visualization.DataTable;try{d.each(function(b){var c=a(this);"tooltip"!==c.attr("data-type")?i.addColumn(c.attr("data-type"),c.text()):e.options.tooltipConcat===[]&&e.options.tooltipConcat.push(b)}),e.options.tooltipConcat.length>0&&i.addColumn({type:"string",role:"tooltip"}),h.each(function(){var b=(i.getNumberOfRows(),[]),c=[];if(a(this).find("td").each(function(d){var f=a(this),g=i.getColumnType(d);"date"===g?b.push(new Date(f.text())):"string"===g?b.push(f.text()):"number"===g&&b.push(Number(f.text()));var h=a.inArray(d,e.options.tooltipConcat);-1!==h?c[h]=f.text():"tooltip"===g&&c.push(f.text())}),b.length>0)for(var d=0;d<e.options.tooltipConcat.length;d++)"string"==typeof e.options.tooltipConcat[d]&&(c[d]=e.options.tooltipConcat[d]);if(c.length>0){for(var f="",d=0;d<c.length;d++)f=f+String(c[d])+" ";b.push(f)}b.length>0&&i.addRow(b)})}catch(j){return e.showTableChart("show","remove"),void console.log(j+f.attr("id"))}if(0===i.getNumberOfRows())return e.showTableChart("show","remove"),void console.log("no data"+f.attr("id"));if("none"!==e.options.tableChart.formatter.type){console.log(e.options.chartType);var k=new google.visualization[e.options.tableChart.formatter.type](e.options.tableChart.formatter);k.format(i,e.options.tableChart.formatter.column)}if(b=a.extend(!0,{},e.options),"BarChart"===b.chartType)b=b.barChart,b.title=b.title||c,b.height=b.height||2*e.options.fontSize*i.getNumberOfRows();else if("ColumnChart"===b.chartType)b=b.columnChart,b.title=b.title||c,b.height=b.height||.75*g.width();else if("PieChart"===b.chartType)b=b.pieChart,b.title=b.title||c,b.height=b.height||.75*g.width();else if("GeoChart"===b.chartType)b=b.geoChart,b.height=b.height||.75*g.width();else if("Calendar"===b.chartType)b=b.calendarChart,b.title=b.title||c;else{if("Table"!==e.options.chartType)return console.log("Not a recognized chart type"),void e.showTableChart("show","remove");b=b.tableChart}var l=new google.visualization[e.options.chartType](g.get(0));google.visualization.events.addListener(l,"ready",function(){e.showTableChart(e.options.showTable,"show"),console.log("drawn "+f.attr("id"))}),google.visualization.events.addListener(l,"error",function(a){e.showTableChart("show","remove"),console.log("draw error on "+f.attr("id")+a)}),l.draw(i,b),console.log("draw-end"+f.attr("id"))},e.showTableChart=function(a,b){var c=f.length,d=g.length;"show"===a&&c?(f.css("opacity",0),f.css(e.options.showTableCSS),f.fadeTo(400,1)):"hide"===a&&c?f.css(e.options.hideTableCSS):"remove"===a&&c&&f.css("display","none"),"show"===b&&d?(g.css("opacity",0),g.css(e.options.showChartCSS),g.fadeTo(400,1)):"hide"===b&&d?g.css(e.options.showChartCSS):"remove"===b&&d&&g.css("display","none")},e.init(c,d),this};a.fn.chartinator=function(b){return this.each(function(){var d=a(this);d.data("chartinator")||a(this).data("chartinator",new c(this,b))})}}(jQuery,window,document,Math);